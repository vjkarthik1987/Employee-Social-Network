<% layout('layouts/_layout') %>

<section class="profile-page">
  <!-- Top card -->
  <div class="card profile-hero">
    <div class="profile-hero-row">
      <div class="profile-avatar">
        <img src="<%= profileUser.avatarUrl || '/img/avatar.png' %>" alt="avatar">
      </div>

      <div class="profile-meta">
        <h2 class="profile-name"><%= profileUser.fullName %></h2>

        <div class="profile-sub">
          <%= profileUser.title || '' %>
          <% if (profileUser.title && profileUser.department) { %>
            <span class="dot">•</span>
          <% } %>
          <%= profileUser.department || '' %>
        </div>

        <div class="profile-links">
          <% if (profileUser.linkedinUrl) { %>
            <a class="profile-link" href="<%= profileUser.linkedinUrl %>" target="_blank" rel="noopener noreferrer">
              LinkedIn <span aria-hidden="true">↗</span>
            </a>
          <% } %>
        </div>
      </div>

      <div class="profile-actions">
        <% if (canEdit) { %>
          <a class="btn" href="/<%= company.slug %>/profile/<%= String(user._id) === String(profileUser._id) ? 'me' : profileUser._id %>/edit">
            Edit Profile
          </a>
        <% } %>
      </div>
    </div>

    <!-- Stats -->
    <div class="profile-stats">
      <div class="stat-pill">
        <div class="stat-value"><%= profileUser.postsCount || 0 %></div>
        <div class="stat-label">Posts</div>
      </div>
      <div class="stat-pill">
        <div class="stat-value"><%= profileUser.commentsCount || 0 %></div>
        <div class="stat-label">Comments</div>
      </div>
      <div class="stat-pill">
        <div class="stat-value"><%= profileUser.reactionsGivenCount || 0 %></div>
        <div class="stat-label">Reactions</div>
      </div>
    </div>

    <!-- About -->
    <% if (profileUser.bio) { %>
      <div class="profile-section">
        <h3 class="section-title">About</h3>
        <p class="profile-bio"><%= profileUser.bio %></p>
      </div>
    <% } %>

    <!-- Skills & Interests -->
    <div class="profile-two">
      <% if ((profileUser.skills||[]).length) { %>
        <div class="profile-section">
          <h4 class="section-title small">Skills</h4>
          <div class="tag-row">
            <% (profileUser.skills||[]).forEach(s => { %>
              <span class="tag tag-role-member"><%= s %></span>
            <% }) %>
          </div>
        </div>
      <% } %>

      <% if ((profileUser.interests||[]).length) { %>
        <div class="profile-section">
          <h4 class="section-title small">Interests</h4>
          <div class="tag-row">
            <% (profileUser.interests||[]).forEach(s => { %>
              <span class="tag tag-status-invited"><%= s %></span>
            <% }) %>
          </div>
        </div>
      <% } %>
    </div>
  </div>

  <!-- Lower grid -->
  <div class="profile-grid">
    <div>
      <div class="section-head">
        <h3 class="section-title">Recent posts</h3>
      </div>

      <% if (!posts.length) { %>
        <div class="empty">No posts yet.</div>
      <% } %>

      <% posts.forEach(function(post){ %>
        <%- include('../partials/_post_card', { company, user, post }) %>
      <% }) %>
    </div>

    <aside>
      <div class="card profile-side">
        <div class="section-head">
          <h3 class="section-title">Groups</h3>
        </div>

        <% if (!groups.length) { %>
          <div class="empty">Not in any groups yet.</div>
        <% } %>

        <ul class="group-list">
          <% groups.forEach(function(g){ %>
            <li class="group-item">
              <a class="group-link" href="/<%= company.slug %>/g/<%= g._id %>"><%= g.name %></a>
              <% if (g.isPrivate) { %>
                <span class="tag tag-status-suspended">Private</span>
              <% } %>
            </li>
          <% }) %>
        </ul>
      </div>
    </aside>
  </div>
</section>
