<!-- debug: <%= Array.isArray(internalLinks) ? internalLinks.length : 'no-var' %> -->
<% if (Array.isArray(internalLinks) && internalLinks.length) { %>
    <div class="card" style="padding:12px;display:grid;gap:8px;">
      <div class="il-grid">
        <% internalLinks.forEach(function(l){ %>
          <a class="il-tile" href="<%= l.url %>" target="_blank" rel="noopener"
             title="<%= l.title %>" aria-label="<%= l.title %> â€“ opens in new tab"
             data-link-id="<%= l._id %>">
            <!-- <span class="il-icon"><%= l.icon %></span> -->
            <span class="il-text"><%= l.title %></span>
          </a>
        <% }) %>
      </div>
    </div>
  <% } %>
  
  <script>
    document.addEventListener('click', (e) => {
      const a = e.target.closest('a[data-link-id]');
      if (!a) return;
    
      const id = a.getAttribute('data-link-id');
      if (!id) return;
    
      // Try to resolve org slug from available locals injected into the page
      var orgSlug = '<%= (company && company.slug) ? company.slug
                     : (typeof org !== "undefined" && org && org.slug) ? org.slug
                     : (typeof slug !== "undefined" && slug) ? slug
                     : "" %>';
    
      // If we still don't have a slug (e.g., login page), skip the tracking call
      if (!orgSlug) return;
    
      fetch(`/${orgSlug}/api/links/${id}/click`, {
        method: 'POST',
        headers: { 'Accept': 'application/json' }
      });
    });
    </script>
    
  