<!-- views/partials/navbar.ejs -->
<nav class="navbar">
  <div class="nav-inner">
    <!-- Brand -->
    <a class="brand" href="/<%= (org||company)?.slug %>/feed">
      <% if (company?.branding?.logoUrl) { %>
        <img src="<%= company.branding.logoUrl %>" alt="<%= company?.name || 'Engage' %>" class="brand-logo">
      <% } %>
      <span class="brand-name">
        <%= (org?.productName && org.productName.trim())
            ? org.productName
            : (org?.name || company?.name || 'Engage') %>
      </span>
    </a>

    <!-- Hamburger (mobile only, right aligned) -->
    <button class="hamburger"
      aria-label="Menu"
      aria-expanded="false"
      onclick="window.toggleDrawer(this)">
      <span></span><span></span><span></span>
    </button>
  </div>

  <!-- Links -->
  <div class="nav-links">
    <% if (org) { %>
      <a href="/<%= org.slug %>/feed">Feed</a>
      <a href="/<%= org.slug %>/groups">Groups</a>
      <a href="/<%= org.slug %>/newsletters"
        class="nav-link"> Newsletters
     </a>
      <% if (currentUser) { %>
        <a href="/<%= org.slug %>/profile/<%= currentUser._id %>">My Profile</a>
      <% } %>
        <a href="/<%= company.slug %>/mod/queue" class="<%= currentPath.includes('/mod/queue') ? 'active' : '' %>">
          Moderation
          <% if (typeof moderationQueueCount !== 'undefined' && moderationQueueCount > 0) { %>
            <span class="nav-pill"><%= moderationQueueCount %></span>
          <% } %>
        </a>
      <% if (currentUser && currentUser.role === 'ORG_ADMIN') { %>
        <a href="/<%= org.slug %>/admin/settings">Admin</a>
        <a href="/<%= org.slug %>/admin/users">Users</a>
      <% } %>
      <% if (currentUser) { %>
        <form method="POST" action="/<%= org.slug %>/auth/logout" class="logout-form">
          <input type="hidden" name="_csrf" value="<%= typeof csrfToken !== 'undefined' ? csrfToken : '' %>">
          <button class="btn btn-ghost btn-sm" type="submit" style="background-color:red;">Logout</button>
        </form>
      <% } else { %>
        <a class="btn btn-ghost btn-sm" href="/auth/login">Login</a>
      <% } %>
    <% } %>
  </div>

  <div id="nav-backdrop" class="nav-backdrop" hidden></div>
</nav>

<script>
(function () {
  const navbar = document.querySelector('.navbar');
  const backdrop = document.getElementById('nav-backdrop');
  window.toggleDrawer = function (btn) {
    navbar.classList.toggle('open');
    const isOpen = navbar.classList.contains('open');
    btn?.setAttribute('aria-expanded', isOpen);
    backdrop.classList.toggle('show', isOpen);
  };
  backdrop.addEventListener('click', () => {
    navbar.classList.remove('open');
    backdrop.classList.remove('show');
    document.querySelector('.hamburger')?.setAttribute('aria-expanded','false');
  });
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') {
      navbar.classList.remove('open');
      backdrop.classList.remove('show');
      document.querySelector('.hamburger')?.setAttribute('aria-expanded','false');
    }
  });
})();
</script>
