<!-- views/partials/_reply.ejs -->
<li class="comment-card" data-reply-id="<%= r._id %>">
  <div class="comment-header">
    <div class="ch-left">
      <img class="avatar-sm" src="<%= r.authorId?.avatarUrl || '/img/avatar.png' %>" alt="">
      <div class="meta">
        <span class="comment-author"><%= r.authorId?.fullName || 'User' %></span>
        <span class="comment-time">â€¢ <%= new Date(r.createdAt).toLocaleString() %></span>
        <% if (r.editedAt) { %><span class="edited-badge" title="Edited">(edited)</span><% } %>
      </div>
    </div>
    <div class="ch-actions">
      <% const canActR = user && (
           String(user._id) === String(r.authorId?._id || r.authorId) ||
           ['ORG_ADMIN','MODERATOR'].includes(user.role)
         ); %>
      <% if (canActR && r.status !== 'deleted') { %>
        <button class="icon-btn danger subtle" title="Delete reply" aria-label="Delete reply"
                data-ajax-delete data-comment-id="<%= r._id %>">ğŸ—‘ï¸</button>
      <% } %>
      <form method="POST" action="/<%= company.slug %>/report" class="inline" style="display:inline;">
        <input type="hidden" name="_csrf" value="<%= typeof csrfToken !== 'undefined' ? csrfToken : '' %>">
        <input type="hidden" name="targetType" value="comment">
        <input type="hidden" name="targetId" value="<%= r._id %>">
        <input type="hidden" name="reasonCode" value="INAPPROPRIATE">
        <button class="icon-btn subtle" title="Report" aria-label="Report">âš‘</button>
      </form>
    </div>
  </div>

  <div class="comment-body <%= r.status === 'deleted' ? 'is-deleted' : '' %>">
    <% if (r.status === 'deleted') { %>
      <em>(deleted)</em>
    <% } else { %>
      <div class="comment-content"><%- r.content %></div>
    <% } %>
  </div>
</li>
